<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Physics 1 Quiz - Interactive Practice Tool</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles-flexoki.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"
        integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"
        integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx"
        crossorigin="anonymous"></script>

    <!-- Markdown processing (for future use) -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
</head>

<body>
    <!-- Physics-themed SVG background decoration -->
    <svg class="hero-decoration" viewBox="0 0 1200 400" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
            <linearGradient id="orbit-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:var(--accent-primary);stop-opacity:0.1" />
                <stop offset="100%" style="stop-color:var(--accent-secondary);stop-opacity:0.05" />
            </linearGradient>
        </defs>
        <!-- Orbital paths -->
        <ellipse cx="200" cy="200" rx="150" ry="80" stroke="var(--border-color)" stroke-width="1.5" fill="none"
            opacity="0.3" />
        <ellipse cx="200" cy="200" rx="100" ry="50" stroke="var(--border-color)" stroke-width="1.5" fill="none"
            opacity="0.3" />
        <circle cx="200" cy="200" r="15" fill="var(--accent-primary)" opacity="0.6" />
        <circle cx="320" cy="180" r="6" fill="var(--accent-secondary)" opacity="0.5" />

        <!-- Wave patterns -->
        <path d="M 400 200 Q 450 150, 500 200 T 600 200 T 700 200" stroke="var(--accent-primary)" stroke-width="2"
            fill="none" opacity="0.2" />
        <path d="M 400 220 Q 450 170, 500 220 T 600 220 T 700 220" stroke="var(--accent-secondary)" stroke-width="2"
            fill="none" opacity="0.15" />

        <!-- Force vectors -->
        <line x1="850" y1="250" x2="950" y2="150" stroke="var(--accent-primary)" stroke-width="2.5" opacity="0.3" />
        <polygon points="950,150 945,160 940,155" fill="var(--accent-primary)" opacity="0.3" />
        <line x1="850" y1="250" x2="950" y2="250" stroke="var(--success)" stroke-width="2.5" opacity="0.3" />
        <polygon points="950,250 945,255 945,245" fill="var(--success)" opacity="0.3" />

        <!-- Particles -->
        <circle cx="1050" cy="150" r="4" fill="var(--accent-primary)" opacity="0.4" />
        <circle cx="1100" cy="200" r="5" fill="var(--accent-secondary)" opacity="0.4" />
        <circle cx="1080" cy="250" r="3" fill="var(--accent-primary)" opacity="0.4" />
    </svg>

    <header>
        <div class="site-header">
            <a href="../index.html" class="site-title">
                <span class="site-logo">‚öõÔ∏è</span>
                Mr. Porter Physics
            </a>
            <nav class="site-nav">
                <a href="../index.html" class="page-link">Home</a>
                <a href="../courses/ap-physics-1.html" class="page-link">AP Physics 1</a>
                <button type="button" class="btn btn-secondary keyboard-help-btn" title="Keyboard shortcuts">
                    ‚å®Ô∏è
                </button>
            </nav>
        </div>
    </header>

    <div class="app-container">
        <div class="quiz-header">
            <h1>AP Physics 1 Quiz</h1>
            <p class="text-center text-muted">Interactive practice tool with comprehensive fact sheet integration</p>

            <!-- Quick Links -->
            <div class="quick-links text-center">
                <a href="factsheet-complete.html" target="_blank" class="btn btn-secondary">
                    üìö View AP Physics 1 Fact Sheet
                </a>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen">
            <!-- Course Selection -->
            <div class="course-selection">
                <button class="course-btn active" data-course="ap-physics">
                    AP Physics 1
                </button>
                <!-- Earth Science disabled for initial release -->
                <!-- <button class="course-btn" data-course="earth-science">
                    Earth Science
                </button> -->
            </div>

            <!-- Subject Selection -->
            <div class="subject-selection">
                <h3>üìö Subject Focus</h3>
                <div class="subject-options">
                    <button class="subject-btn active" data-subject="all">
                        <div class="btn-emoji">üåü</div>
                        <div class="btn-content">
                            <strong>All Topics</strong>
                            <span>Complete review</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="kinematics">
                        <div class="btn-emoji">üöÄ</div>
                        <div class="btn-content">
                            <strong>Kinematics</strong>
                            <span>Motion, velocity, acceleration</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="forces">
                        <div class="btn-emoji">‚ö°</div>
                        <div class="btn-content">
                            <strong>Forces</strong>
                            <span>Newton's laws, friction, equilibrium</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="energy">
                        <div class="btn-emoji">üîã</div>
                        <div class="btn-content">
                            <strong>Energy</strong>
                            <span>Work, kinetic, potential energy</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="momentum">
                        <div class="btn-emoji">üí•</div>
                        <div class="btn-content">
                            <strong>Momentum</strong>
                            <span>Collisions, impulse</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="rotation">
                        <div class="btn-emoji">üåÄ</div>
                        <div class="btn-content">
                            <strong>Rotation</strong>
                            <span>Angular motion, torque</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="gravitation">
                        <div class="btn-emoji">ü™ê</div>
                        <div class="btn-content">
                            <strong>Gravitation</strong>
                            <span>Orbits, gravitational force</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="shm">
                        <div class="btn-emoji">„Ä∞Ô∏è</div>
                        <div class="btn-content">
                            <strong>Simple Harmonic Motion</strong>
                            <span>Oscillations, springs</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="fluids">
                        <div class="btn-emoji">üíß</div>
                        <div class="btn-content">
                            <strong>Fluids</strong>
                            <span>Pressure, buoyancy, flow</span>
                        </div>
                    </button>
                    <button class="subject-btn" data-subject="waves">
                        <div class="btn-emoji">üåä</div>
                        <div class="btn-content">
                            <strong>Waves</strong>
                            <span>Wave properties, sound</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Mode Selection -->
            <div class="mode-selection">
                <h3>üéØ Study Mode</h3>
                <div class="mode-options">
                    <button class="mode-btn active" data-mode="learning">
                        <div class="btn-emoji">üß†</div>
                        <div class="btn-content">
                            <strong>Learning</strong>
                            <span>Immediate feedback and explanations</span>
                        </div>
                    </button>
                    <button class="mode-btn" data-mode="test">
                        <div class="btn-emoji">üìù</div>
                        <div class="btn-content">
                            <strong>Test</strong>
                            <span>No feedback until complete</span>
                        </div>
                    </button>
                    <button class="mode-btn" data-mode="review">
                        <div class="btn-emoji">üîÑ</div>
                        <div class="btn-content">
                            <strong>Review</strong>
                            <span>Practice missed questions only</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Start Button -->
            <div class="text-center">
                <button id="start-quiz" class="btn btn-primary start-btn">
                    <span class="btn-emoji">üöÄ</span>
                    Start Quiz
                </button>
            </div>

            <!-- Quiz Statistics -->
            <div class="quiz-stats">
                <div id="stats-display" class="text-center text-muted">
                    <p>Loading question statistics...</p>
                </div>
            </div>

            <!-- Topic Mastery Overview -->
            <div id="topic-mastery" class="topic-mastery" style="display: none;">
                <h4>üìä Topic Mastery</h4>
                <div id="mastery-meters" class="mastery-meters">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Study Resources -->
            <div class="study-resources">
                <h4>üìñ Study Resources</h4>
                <div class="resource-links">
                    <a href="factsheet-complete.html" target="_blank" class="resource-link">
                        üìã Complete Fact Sheet Reference
                    </a>
                    <p class="text-muted">Access all AP Physics 1 formulas, concepts, and equations</p>
                </div>
            </div>
        </div>

        <!-- Quiz Screen (Initially Hidden) -->
        <div id="quiz-screen" style="display: none;">
            <!-- Progress Section -->
            <div class="progress-container">
                <div id="question-counter" class="question-counter">
                    Question 1 of 20
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>

                <!-- Streak Counter -->
                <div id="streak-display" class="streak-display" style="display: none;">
                    <div id="current-streak" class="streak-counter">0</div>
                    <div class="streak-text">Current Streak</div>
                    <div id="personal-best" class="personal-best">Best: 0</div>
                </div>
            </div>

            <!-- Question Container -->
            <div class="question-container">
                <!-- Question Breadcrumb -->
                <div id="question-breadcrumb" class="question-breadcrumb">
                    <span>AP Physics 1</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span id="breadcrumb-topic">Forces</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span id="breadcrumb-type">Multiple Choice</span>
                </div>

                <!-- Question Header -->
                <div class="question-header">
                    <div id="question-type" class="question-type">
                        <span class="type-icon">üî§</span>
                        <span class="type-name">Multiple Choice</span>
                    </div>
                    <div id="question-topic" class="question-topic">
                        Forces
                    </div>
                    <div id="question-difficulty" class="question-difficulty">
                        <span class="stars">‚òÖ‚òÖ‚òÜ</span>
                        <span class="difficulty-text">Level 2</span>
                    </div>
                </div>

                <!-- Question Text -->
                <div id="question-text" class="question-text">
                    Loading question...
                </div>

                <!-- Answer Options -->
                <div id="answer-options" class="answer-options">
                    <!-- Dynamically populated -->
                </div>

                <!-- Fact Sheet Integration -->
                <div class="fact-sheet-section">
                    <!-- Dynamically populated by factsheet-integration.js -->
                </div>
            </div>

            <!-- Feedback Section -->
            <div id="feedback" class="feedback">
                <!-- Dynamically populated -->
            </div>

            <!-- Explanation Section -->
            <div id="explanation" class="explanation">
                <!-- Dynamically populated -->
            </div>

            <!-- Quiz Controls -->
            <div class="quiz-controls">
                <button id="prev-question" class="btn btn-secondary">
                    ‚Üê Previous
                </button>

                <div class="control-center">
                    <button id="bookmark-question" class="btn btn-secondary" title="Bookmark this question">
                        üìñ
                    </button>
                    <button id="submit-answer" class="btn btn-primary">
                        Submit Answer
                    </button>
                    <button id="next-question" class="btn btn-primary" style="display: none;">
                        Next ‚Üí
                    </button>
                </div>

                <button id="reset-quiz" class="btn btn-secondary">
                    Reset Quiz
                </button>
            </div>
        </div>

        <!-- Message Display -->
        <div id="message-display" class="feedback" style="display: none;">
            <!-- For user messages -->
        </div>

        <!-- Settings Modal (Future Implementation) -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <button type="button" class="modal-close">&times;</button>
                <h3>Quiz Settings</h3>
                <p>Settings panel coming soon...</p>
            </div>
        </div>

        <!-- Keyboard Shortcuts Modal -->
        <div id="keyboard-shortcuts-modal" class="modal">
            <div class="modal-content">
                <button type="button" class="modal-close" onclick="document.getElementById('keyboard-shortcuts-modal').style.display='none'">&times;</button>
                <h3>Keyboard Shortcuts</h3>
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <kbd>‚Üí</kbd> <span>Next question</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>‚Üê</kbd> <span>Previous question</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Enter</kbd> <span>Submit answer (when typing)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>R</kbd> <span>Reset quiz</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>1-5</kbd> <span>Select answer option (MC)</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>T / F</kbd> <span>Select True/False</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Core JavaScript Modules -->
    <script src="js/fallback-data.js?v=1"></script>
    <script src="js/utils.js?v=1"></script>
    <script src="js/quiz-storage.js?v=1"></script>
    <script src="js/quiz-data.js?v=1"></script>
    <script src="js/quiz-ui.js?v=1"></script>

    <!-- Fact Sheet Integration -->
    <script src="js/factsheet-integration.js"></script>

    <!-- UX Enhancement Modules -->
    <script src="js/topic-mastery.js?v=1"></script>
    <script src="js/streak-tracker.js?v=1"></script>
    <script src="js/bookmark-system.js?v=1"></script>
    <script src="js/performance-analytics.js?v=1"></script>
    <script src="js/spaced-repetition.js?v=1"></script>
    <script src="js/hint-system.js?v=1"></script>
    <script src="js/rapid-fire-mode.js?v=1"></script>
    <script src="js/study-guides.js?v=1"></script>
    <script src="js/achievement-system.js?v=1"></script>
    <script src="js/mobile-optimization.js?v=1"></script>

    <!-- Main Application -->
    <script src="js/app.js?v=1"></script>

    <!-- Test Runner (Dev Tool) -->
    <script src="js/test-runner.js?v=1"></script>

    <!-- Global Error Handling -->
    <script>
        // Global error handler for unhandled JavaScript errors
        window.addEventListener('error', function (event) {
            Utils.handleError(event.error || new Error(event.message), 'Global error handler');

            // Show user-friendly error message
            if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showMessage === 'function') {
                PhysicsQuizApp.showMessage('An unexpected error occurred. The application will continue working.', 'warning');
            }
        });

        // Global handler for unhandled promise rejections
        window.addEventListener('unhandledrejection', function (event) {
            Utils.handleError(event.reason, 'Unhandled promise rejection');

            // Show user-friendly error message
            if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showMessage === 'function') {
                PhysicsQuizApp.showMessage('A background operation failed. Some features may not work as expected.', 'warning');
            }
        });

        // Monitor page load for critical errors
        window.addEventListener('load', function () {
            // Check if essential elements loaded
            setTimeout(function () {
                const essentialElements = ['start-screen', 'quiz-screen'];
                const missingElements = essentialElements.filter(id => !document.getElementById(id));

                if (missingElements.length > 0) {
                    console.error('Missing essential elements:', missingElements);
                    if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showCriticalError === 'function') {
                        PhysicsQuizApp.showCriticalError(
                            'Page Loading Error',
                            'Some essential components failed to load. Please refresh the page.',
                            () => window.location.reload()
                        );
                    }
                }
            }, 1000);
        });
    </script>

    <!-- Theme Toggle Script -->
    <script>
        // Theme toggle functionality with proper icon updates
        function updateThemeIcon(theme) {
            const themeBtn = document.querySelector('.theme-toggle');
            if (themeBtn) {
                themeBtn.innerHTML = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                themeBtn.title = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        // Load saved theme immediately (before DOMContentLoaded)
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Add theme toggle button
        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.querySelector('.site-nav');
            if (nav) {
                const themeBtn = document.createElement('button');
                themeBtn.className = 'btn btn-secondary theme-toggle';
                themeBtn.style.padding = '8px 12px';
                themeBtn.style.marginLeft = '10px';
                themeBtn.onclick = toggleTheme;
                nav.appendChild(themeBtn);
                // Set initial icon based on current theme
                updateThemeIcon(savedTheme);
            }
        });
    </script>

    <!-- Fact Sheet Links System -->

    <!-- Application Initialization -->
    <script>
        // Initialize the main application when DOM is ready
        document.addEventListener("DOMContentLoaded", function () {
            if (window.PhysicsQuizApp) {
                PhysicsQuizApp.init();
            } else {
                console.error("PhysicsQuizApp not loaded");
            }

            // Keyboard shortcuts modal
            const keyboardHelpBtn = document.querySelector('.keyboard-help-btn');
            const keyboardModal = document.getElementById('keyboard-shortcuts-modal');

            if (keyboardHelpBtn && keyboardModal) {
                keyboardHelpBtn.addEventListener('click', () => {
                    keyboardModal.style.display = 'block';
                });

                // Close on backdrop click
                keyboardModal.addEventListener('click', (e) => {
                    if (e.target === keyboardModal) {
                        keyboardModal.style.display = 'none';
                    }
                });
            }

            // Enhanced keyboard shortcuts for quiz
            document.addEventListener('keydown', (e) => {
                // Skip if typing in an input field or modifier keys pressed
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                if (e.ctrlKey || e.metaKey || e.altKey) return;

                const quizScreen = document.getElementById('quiz-screen');
                if (!quizScreen || quizScreen.style.display === 'none') return;

                // Number keys 1-5 for selecting MC options
                if (e.key >= '1' && e.key <= '5') {
                    const optionIndex = parseInt(e.key) - 1;
                    const options = document.querySelectorAll('input[name="mc-answer"]');
                    if (options[optionIndex]) {
                        options[optionIndex].checked = true;
                        options[optionIndex].dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }

                // T/F keys for True/False questions
                if (e.key.toLowerCase() === 't') {
                    const trueOption = document.querySelector('input[name="tf-answer"][value="true"]');
                    if (trueOption) {
                        trueOption.checked = true;
                        trueOption.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }
                if (e.key.toLowerCase() === 'f') {
                    const falseOption = document.querySelector('input[name="tf-answer"][value="false"]');
                    if (falseOption) {
                        falseOption.checked = true;
                        falseOption.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                }

                // Escape to close modals
                if (e.key === 'Escape') {
                    if (keyboardModal) keyboardModal.style.display = 'none';
                    const feedbackModal = document.getElementById('feedback');
                    if (feedbackModal && feedbackModal.style.display !== 'none') {
                        if (window.QuizUI) QuizUI.closeFeedbackModal();
                    }
                }
            });
        });
    </script>
    <script src="js/fact-sheet-links.js"></script>
</body>

</html>