<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Physics 1 Quiz - Interactive Practice Tool</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles-flexoki.css">
    
    <!-- Math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    
    <!-- Markdown processing (for future use) -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>AP Physics 1 Quiz</h1>
            <p class="text-center text-muted">Interactive practice tool with comprehensive fact sheet integration</p>
            
            <!-- Quick Links -->
            <div class="quick-links text-center">
                <a href="factsheet-complete.html" target="_blank" class="btn btn-secondary">
                    üìö View AP Physics 1 Fact Sheet
                </a>
            </div>
        </header>

        <!-- Start Screen -->
        <div id="start-screen">
            <!-- Course Selection -->
            <div class="course-selection">
                <button class="course-btn active" data-course="ap-physics">
                    AP Physics 1
                </button>
                <!-- Earth Science disabled for initial release -->
                <!-- <button class="course-btn" data-course="earth-science">
                    Earth Science
                </button> -->
            </div>

            <!-- Mode Selection -->
            <div class="mode-selection">
                <h3>Study Mode</h3>
                <div class="mode-options">
                    <div class="mode-option">
                        <label>
                            <input type="radio" name="mode" value="learning" checked>
                            <strong>Learning</strong> - Immediate feedback and explanations
                        </label>
                    </div>
                    <div class="mode-option">
                        <label>
                            <input type="radio" name="mode" value="test">
                            <strong>Test</strong> - No feedback until complete
                        </label>
                    </div>
                    <div class="mode-option">
                        <label>
                            <input type="radio" name="mode" value="review">
                            <strong>Review</strong> - Practice missed questions only
                        </label>
                    </div>
                </div>
            </div>

            <!-- Quiz Statistics -->
            <div class="quiz-stats">
                <div id="stats-display" class="text-center text-muted">
                    <p>Loading question statistics...</p>
                </div>
            </div>

            <!-- Study Resources -->
            <div class="study-resources">
                <h4>üìñ Study Resources</h4>
                <div class="resource-links">
                    <a href="factsheet-complete.html" target="_blank" class="resource-link">
                        üìã Complete Fact Sheet Reference
                    </a>
                    <p class="text-muted">Access all AP Physics 1 formulas, concepts, and equations</p>
                </div>
            </div>

            <!-- Start Button -->
            <div class="text-center">
                <button id="start-quiz" class="btn btn-primary">
                    Start Quiz
                </button>
            </div>
        </div>

        <!-- Quiz Screen (Initially Hidden) -->
        <div id="quiz-screen" style="display: none;">
            <!-- Progress Section -->
            <div class="progress-container">
                <div id="question-counter" class="question-counter">
                    Question 1 of 20
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>

            <!-- Question Container -->
            <div class="question-container">
                <!-- Question Header -->
                <div class="question-header">
                    <div id="question-type" class="question-type">
                        <span class="type-icon">üî§</span>
                        <span class="type-name">Multiple Choice</span>
                    </div>
                    <div id="question-topic" class="question-topic">
                        Forces
                    </div>
                    <div id="question-difficulty" class="question-difficulty">
                        <span class="stars">‚òÖ‚òÖ‚òÜ</span>
                        <span class="difficulty-text">Level 2</span>
                    </div>
                </div>

                <!-- Question Text -->
                <div id="question-text" class="question-text">
                    Loading question...
                </div>

                <!-- Answer Options -->
                <div id="answer-options" class="answer-options">
                    <!-- Dynamically populated -->
                </div>

                <!-- Fact Sheet Integration -->
                <div class="fact-sheet-section">
                    <!-- Dynamically populated by factsheet-integration.js -->
                </div>
            </div>

            <!-- Feedback Section -->
            <div id="feedback" class="feedback">
                <!-- Dynamically populated -->
            </div>

            <!-- Explanation Section -->
            <div id="explanation" class="explanation">
                <!-- Dynamically populated -->
            </div>

            <!-- Quiz Controls -->
            <div class="quiz-controls">
                <button id="prev-question" class="btn btn-secondary">
                    ‚Üê Previous
                </button>
                
                <div class="control-center">
                    <button id="bookmark-question" class="btn btn-secondary" title="Bookmark this question">
                        üìñ
                    </button>
                    <button id="submit-answer" class="btn btn-primary">
                        Submit Answer
                    </button>
                    <button id="next-question" class="btn btn-primary" style="display: none;">
                        Next ‚Üí
                    </button>
                </div>
                
                <button id="reset-quiz" class="btn btn-secondary">
                    Reset Quiz
                </button>
            </div>
        </div>

        <!-- Message Display -->
        <div id="message-display" class="feedback" style="display: none;">
            <!-- For user messages -->
        </div>

        <!-- Settings Modal (Future Implementation) -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close">&times;</button>
                <h3>Quiz Settings</h3>
                <p>Settings panel coming soon...</p>
            </div>
        </div>
    </div>

    <!-- Core JavaScript Modules -->
    <script src="js/utils.js"></script>
    <script src="js/quiz-storage.js"></script>
    <script src="js/quiz-data.js"></script>
    <script src="js/quiz-ui.js"></script>
    
    <!-- Fact Sheet Integration -->
    <script src="js/factsheet-integration.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>
    
    <!-- Global Error Handling -->
    <script>
        // Global error handler for unhandled JavaScript errors
        window.addEventListener('error', function(event) {
            Utils.handleError(event.error || new Error(event.message), 'Global error handler');
            
            // Show user-friendly error message
            if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showMessage === 'function') {
                PhysicsQuizApp.showMessage('An unexpected error occurred. The application will continue working.', 'warning');
            }
        });

        // Global handler for unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            Utils.handleError(event.reason, 'Unhandled promise rejection');
            
            // Show user-friendly error message
            if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showMessage === 'function') {
                PhysicsQuizApp.showMessage('A background operation failed. Some features may not work as expected.', 'warning');
            }
        });

        // Monitor page load for critical errors
        window.addEventListener('load', function() {
            // Check if essential elements loaded
            setTimeout(function() {
                const essentialElements = ['start-screen', 'quiz-screen'];
                const missingElements = essentialElements.filter(id => !document.getElementById(id));
                
                if (missingElements.length > 0) {
                    console.error('Missing essential elements:', missingElements);
                    if (window.PhysicsQuizApp && typeof PhysicsQuizApp.showCriticalError === 'function') {
                        PhysicsQuizApp.showCriticalError(
                            'Page Loading Error',
                            'Some essential components failed to load. Please refresh the page.',
                            () => window.location.reload()
                        );
                    }
                }
            }, 1000);
        });
    </script>
    
    <!-- Theme Toggle Script -->
    <script>
        // Simple theme toggle functionality
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Add theme toggle button
        document.addEventListener('DOMContentLoaded', () => {
            const header = document.querySelector('header');
            if (header) {
                const themeBtn = document.createElement('button');
                themeBtn.innerHTML = 'üåô';
                themeBtn.className = 'btn btn-secondary';
                themeBtn.style.position = 'absolute';
                themeBtn.style.top = '20px';
                themeBtn.style.right = '20px';
                themeBtn.onclick = toggleTheme;
                themeBtn.title = 'Toggle theme';
                header.style.position = 'relative';
                header.appendChild(themeBtn);
            }
        });
    </script>
</body>
</html>